# game_dashboard
게임 관리용 대시보드, 251207

## 작업 수칙 (필독)
- DB의 모든 내용은 절대 삭제 금지.
- `rm -rf`, `rm -rv` 등 강제 삭제 명령 사용 금지. 삭제 필요 시 사유와 내용을 명시해 승인 후 진행.
- 모든 작업은 `/home/clairkim/clair_gamedashboard`에서 진행하고 VS Code와 Git 연동 상태를 유지.
- 파이썬 실행/테스트는 로컬 venv(`backend/.venv`)를 사용해 `backend/.venv/bin/python ...` 형태로 수행할 것.
- 작업 후 README에 간략한 코드 리뷰를 버전명과 함께 작성할 것.
- 배포 시 사용 명령: `~/.fly/bin/flyctl deploy --remote-only`

## v1.1.2 코드 변경 리뷰 (요약)
- 메인 대시보드 알림 추가: 진행 중 이벤트/내일 주간 초기화 게임 안내.
- GameDB 확장: `refresh_day`, `refresh_time` 컬럼 추가 및 상세 화면에 주간/일일 초기화 정보 표시.
- 재화 그래프: 주차 간격 유지, 각 주의 가장 최신 일자 값으로 꼭지점 계산.
- 이벤트 수정 플로우: 리스트 클릭 시 폼 채우기, 수정 버튼으로 PUT 업데이트.
- 숙제 관리(Task/TaskHistory) 연동: 일/주/월 체크박스, 리셋 시 히스토리 기록 후 초기화, 데이터 없으면 숨김.
- 알림의 진행 중 이벤트 포맷 개선([게임, 이벤트, 시작~종료]), 숙제 힌트 메시지 추가.
- 하단 버전 표기: `최초 발행 2025-12-07, 업데이트 2025-12-09, 현재 버전 v.1.1.2`.

## v1.1.3 코드 변경 리뷰 (요약)
- 시드 로직 안정화: 캐릭터/이벤트 시드가 기존 레코드를 덮어쓰지 않도록 신규에만 삽입, 사용자 수정 데이터 롤백 방지.
- 알림 배너 단순화: 진행 중 이벤트를 게임별 집계하여 `[게임, N개]`로 줄바꿈 표기, 가독성 개선.
- 스타일: 알림 줄바꿈 표시를 위해 `white-space: pre-line` 적용.

## v1.1.4 코드 변경 리뷰 (요약)
- 대시보드 알림 시간대 보정: 주간 초기화 알림 계산을 KST(UTC+9) 기준으로 수행해 자정 전후에도 올바른 요일로 안내.

## v1.1.5 코드 변경 리뷰 (요약)
- 숙제 일/주/월 리셋 계산을 KST 기준으로 수행하도록 수정해 갱신 시점에 체크박스가 초기화되고 TaskHistory 기록이 정상 반영되도록 개선.

## v1.2.0 코드 변경 리뷰 (요약)
- 보안 강화: ADMIN_TOKEN 기반 편집 인증과 IP별 Rate Limit(전체/쓰기) 추가, 모든 쓰기 엔드포인트 보호.
- 일일 숙제 UX: “햇슴” 일괄 완료 체크박스와 접힘/펼침 토글 추가.
- 메인 대시보드: 게임 카드에 일/주/월 숙제 완료 뱃지 표시.
- 숙제 편집: 대시보드 내에서 숙제 추가/수정/삭제 편집 플로우 및 서버 업데이트 API 제공.
- 숙제 보상: 숙제별 보상(재화/수량) 입력 드랍박스 추가, 완료 시 해당 재화 자동 누적 및 그래프 반영.
  - 동일 리셋 주기(일/주/월) 내에서 한 번만 지급되며, 초기화 시 다시 받을 수 있음.
- 월정액/패스 보상: Spending에 구성품(재화/수량)과 지급 모드(월정액=매일, 패스=1회) 입력 지원, 활성 상태면 자동 누적. 월정액은 게임 일일 갱신 시 지급, 패스는 활성화 시 1회 지급.
  - 월정액 재구매 시 남은 일수를 합산해 연장. 패스는 최고 레벨 대비 3/4 이상 도달했을 때만 1회 지급.
- 이벤트 입력 정규화: 분류/중요도 드랍박스 고정 옵션 및 서버 밸리데이션.
- 버전 표기: 메인/게임 대시보드 하단에 v1.2.0 문구 노출.

### v1.2.0 코드 리뷰 (2025-01-XX)
- 인증/시크릿: ADMIN_TOKEN 시크릿으로 이전, 하드코딩 암호 제거. DATABASE_URL도 Fly secrets로 이전.
- 재화 연동: 월정액/패스 보상 구성 입력, 월정액 재구매 시 남은 일수 합산 연장, 패스는 75% 레벨 도달 시 1회 지급.
- UI: 메인만 버전 표기, 월정액 편집 UI에 보상/모드/패스 레벨 입력 추가.
- 캐싱: 서비스워커 캐시 버전 갱신(v25)로 최신 배포 강제 반영.

## v1.2.1 코드 변경 리뷰 (요약)
- 메인 알림 UX: 진행 중 이벤트 집계를 알림 문구 하위에 토글(접기/펼치기)로 배치.
- 카드/월정액 레이아웃: 숙제 완료 뱃지, 월정액 남은 일자/보상/갱신/구성 수정 버튼 영역을 랩/분리해 모바일에서 줄바꿈 시 세로 깨짐 방지.
- 편집 인증: 상단에 암호 입력 패널과 “이 기기 기억하기” 체크박스를 추가, 선택 시 로컬에 토큰을 저장해 강력 새로고침 후에도 유지.
- 과금 알림: 남은 일수 3일 이하 월정액/패스 항목을 토글형 알림으로 표시.
- 버전 표기: 현재 버전 v.1.2.1.
- 캐시: 서비스워커 캐시 버전 v27으로 갱신해 최신 배포 강제 반영.
